<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Quiz</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .form-container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }

        .form-header {
            border-bottom: 2px solid #673ab7;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .form-header h1 {
            font-size: 24px;
            margin: 0;
            color: #202124;
        }

        .form-header p {
            font-size: 14px;
            color: #5f6368;
        }

        .question-container {
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #dadce0;
            background-color: #fff;
        }

        .question-container h3 {
            font-size: 18px;
            margin: 0;
            margin-bottom: 10px;
            color: #202124;
        }

        .question-container input[type="text"] {
            width: 100%;
            padding: 10px;
            font-size: 14px;
            border: 1px solid #dadce0;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        .choices-container {
            margin-bottom: 10px;
        }

        .choice-container {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .choice-container input[type="radio"],
        .choice-container input[type="checkbox"] {
            margin-right: 10px;
        }

        .add-choice-btn,
        .remove-question-btn {
            color: #673ab7;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 14px;
            margin-top: 10px;
        }

        .add-choice-btn:hover,
        .remove-question-btn:hover {
            text-decoration: underline;
        }

        .required-toggle {
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .required-toggle label {
            font-size: 14px;
            color: #202124;
        }

        .type-selection {
            margin-bottom: 20px;
        }

        .type-selection select {
            padding: 10px;
            font-size: 14px;
            border: 1px solid #dadce0;
            border-radius: 4px;
        }
    </style>
</head>

<body>
    <div class="form-container">
        <div class="form-header">
            <h1>Create Quiz</h1>
            <p>Specify the type of questions and then add questions accordingly.</p>
        </div>
        <form id="quiz-form" method="post">
            {% csrf_token %}
            {{ quiz_form.as_p }}  <!-- This will render the form fields including the description field -->

            <div class="type-selection">
                <label for="type-select">Select Question Type:</label>
                <select id="type-select">
                    <option value="radio">Single Answer (Radio)</option>
                    <option value="checkbox">Multiple Answers (Checkbox)</option>
                </select>
            </div>

            <div id="questions-container">
                <!-- New questions will be added here -->
            </div>

            <!-- Move the "Create Quiz" button to the end -->
            <button type="submit" id="create-quiz-btn" style="display:none;">Create Quiz</button>
        </form>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            function addNewChoice(container, choiceType) {
                let choicesContainer = container.querySelector('.choices-container');
                let newChoice = document.createElement('div');
                newChoice.classList.add('choice-container');
                newChoice.innerHTML = `
                    <input type="${choiceType}" name="choice_${choicesContainer.children.length + 1}" disabled>
                    <input type="text" name="choice" placeholder="Option ${choicesContainer.children.length + 1}">
                `;
                choicesContainer.appendChild(newChoice);
            }

            function addNewQuestion() {
                let questionsContainer = document.getElementById('questions-container');
                let typeSelect = document.getElementById('type-select');
                let choiceType = typeSelect.value;

                // Create new question container
                let newQuestion = document.createElement('div');
                newQuestion.classList.add('question-container');
                newQuestion.innerHTML = `
                    <h3>Question ${questionsContainer.children.length + 1}</h3>
                    <input type="text" name="question_title" placeholder="Untitled Question">
                    <div class="choices-container">
                        <div class="choice-container">
                            <input type="${choiceType}" name="choice_1" disabled>
                            <input type="text" name="choice" placeholder="Option 1">
                        </div>
                    </div>
                    <button type="button" class="add-choice-btn">Add option</button>
                    <button type="button" class="remove-question-btn">Remove Question</button>
                    <button type="button" class="add-question-btn">+ Add Question</button>
                    <div class="required-toggle">
                        <label>Required</label>
                        <input type="checkbox" name="required">
                    </div>
                `;

                // Add the new question to the container
                questionsContainer.appendChild(newQuestion);

                // Add event listener to the "Add option" button in the new question
                newQuestion.querySelector('.add-choice-btn').addEventListener('click', function () {
                    addNewChoice(newQuestion, choiceType);
                });

                // Add event listener to the "Add Question" button in the new question
                newQuestion.querySelector('.add-question-btn').addEventListener('click', function () {
                    addNewQuestion();
                });

                // Add event listener to the "Remove Question" button
                newQuestion.querySelector('.remove-question-btn').addEventListener('click', function () {
                    questionsContainer.removeChild(newQuestion);
                });

                // Move "Create Quiz" button to the end of the page when the first question is created
                document.getElementById('create-quiz-btn').style.display = 'inline-block';
            }

            // Initial setup: Add the first question
            addNewQuestion();

            // Listen for changes in question type selection
            document.getElementById('type-select').addEventListener('change', function () {
                // When type changes, add a new question with the selected type
                addNewQuestion();
            });

            // Show an alert and redirect when the form is submitted
            document.getElementById('quiz-form').addEventListener('submit', function (event) {
                // Get the quiz title
                let quizTitleElement = document.querySelector('input[name="title"]');
                let quizTitle = quizTitleElement ? quizTitleElement.value : 'Untitled Quiz';

                // Show the alert
                alert('Quiz created');

                // Redirect to Dashboard.html with the quiz title as a query parameter
                window.location.href = `/quizzes/dashboard/?title=${encodeURIComponent(quizTitle)}`;
            });
        });
    </script>
</body>

</html>
